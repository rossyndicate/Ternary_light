<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Part 3 Data quality assessments | Ternary Light Partitioning</title>
  <meta name="description" content="Part 3 Data quality assessments | Ternary Light Partitioning" />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="Part 3 Data quality assessments | Ternary Light Partitioning" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Part 3 Data quality assessments | Ternary Light Partitioning" />
  
  
  

<meta name="author" content="Dr. Matthew Ross" />
<meta name="author" content="Dr. Jim Jawitz" />
<meta name="author" content="Dr. Matt Cohen" />


<meta name="date" content="2023-12-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="download-and-merge-aquasat-data.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.0/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.0/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="part"><span><b>I Motivation and Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#workflow"><i class="fa fa-check"></i><b>1.1</b> Workflow</a></li>
</ul></li>
<li class="part"><span><b>II Data downloads and decisions</b></span></li>
<li class="chapter" data-level="2" data-path="download-and-merge-aquasat-data.html"><a href="download-and-merge-aquasat-data.html"><i class="fa fa-check"></i><b>2</b> Download and Merge Aquasat data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="download-and-merge-aquasat-data.html"><a href="download-and-merge-aquasat-data.html#aquasat-download"><i class="fa fa-check"></i><b>2.1</b> AquaSat download</a></li>
<li class="chapter" data-level="2.2" data-path="download-and-merge-aquasat-data.html"><a href="download-and-merge-aquasat-data.html#aquasat-read-and-join."><i class="fa fa-check"></i><b>2.2</b> AquaSat Read and join.</a></li>
<li class="chapter" data-level="2.3" data-path="download-and-merge-aquasat-data.html"><a href="download-and-merge-aquasat-data.html#data-evalualtion-and-subset"><i class="fa fa-check"></i><b>2.3</b> Data Evalualtion and Subset</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="download-and-merge-aquasat-data.html"><a href="download-and-merge-aquasat-data.html#selecting-only-simultaneous-observations"><i class="fa fa-check"></i><b>2.3.1</b> Selecting only simultaneous observations</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="download-and-merge-aquasat-data.html"><a href="download-and-merge-aquasat-data.html#where-are-sites-with-simultaneous-observations-of-clarity-constituents"><i class="fa fa-check"></i><b>2.4</b> Where are sites with simultaneous observations of clarity constituents?</a></li>
<li class="chapter" data-level="2.5" data-path="download-and-merge-aquasat-data.html"><a href="download-and-merge-aquasat-data.html#what-is-the-general-relationship-between-variables-in-log-log-space"><i class="fa fa-check"></i><b>2.5</b> What is the general relationship between variables in log-log space?</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html"><i class="fa fa-check"></i><b>3</b> Data quality assessments</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#chl-a-to-biomass"><i class="fa fa-check"></i><b>3.1</b> Chl-a to biomass</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#approach"><i class="fa fa-check"></i><b>3.1.1</b> Approach</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#simple-evaluations-of-conversion"><i class="fa fa-check"></i><b>3.1.2</b> Simple evaluations of conversion</a></li>
<li class="chapter" data-level="3.1.3" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#light-attenuation-model-exploration"><i class="fa fa-check"></i><b>3.1.3</b> Light attenuation model exploration</a></li>
<li class="chapter" data-level="3.1.4" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#variation-in-slopes-w-different-chl-biomass-ratios"><i class="fa fa-check"></i><b>3.1.4</b> Variation in slopes w/ different chl biomass ratios</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-quality-assessments.html"><a href="data-quality-assessments.html#final-decision"><i class="fa fa-check"></i><b>3.2</b> Final Decision</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ternary Light Partitioning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-quality-assessments" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Part 3</span> Data quality assessments<a href="data-quality-assessments.html#data-quality-assessments" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="chl-a-to-biomass" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Chl-a to biomass<a href="data-quality-assessments.html#chl-a-to-biomass" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>While it is more common in coastal and oceanic research, inland water scientists
rarely measure water clarity constituents in the way that is most directly
transferable to our research question. Ideally we would routinely measure
concentrations of algal biomass, non-algal particles (including inorganic
sediment and organic sediment, I like to call this stuff dead suspended
sediment, but I guess NAP is fine), and dissolved organic carbon. These
constituents all alter light penetration in water, but they are mutually
exclusive groups with no measurement overlap between algal particles and NAP for
example. However, this is not what we usually measure. Instead, we have rich
datasets of things that could indicate our desired constituents. These map as
basically.</p>
<ul>
<li>Chlorophyll <em>a</em> -&gt; proxy for algal biomass</li>
<li>Total suspended solids (TSS) -&gt; All suspended solids, subtract algal
biomass ≅ NAP</li>
<li>DOC -&gt; DOC!</li>
</ul>
<p>That means we have to basically do one key calculation. Convert chlorohpyll <em>a</em>
to biomass. Then subtract that from TSS and assume that is NAP. While this is a
absurdly simple calculation it is filled with dangers. The relationship between
chlorphyll <em>a</em> and algal biomass depends on temperature and nutrients and
species and is <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1002/2016GB005458">not
universal</a>.
Most studies focus on chlorohpyll:carbon ratios, but we are interested in
chlorophyll:biomass ratio, for which there are much fewer studies, though some
studies below suggest a range of 0.005 to 0.1 chlorophyll:biomass. (I need to
find the C:Biomass study I used forever ago.)</p>
<p>Papers that help:</p>
<ul>
<li><p><a href="https://aslopubs.onlinelibrary.wiley.com/doi/full/10.1002/lno.10338" class="uri">https://aslopubs.onlinelibrary.wiley.com/doi/full/10.1002/lno.10338</a></p></li>
<li><p><a href="https://pubs.usgs.gov/twri/twri9a7/twri9a7_7.4.pdf" class="uri">https://pubs.usgs.gov/twri/twri9a7/twri9a7_7.4.pdf</a></p></li>
<li><p><a href="https://www.researchgate.net/publication/230056019_Relationship_between_Chlorophyll-a_Concentration_and_Phytoplankton_Biomass_in_Several_Reservoirs_in_Czechoslovakia/link/5cb56c164585156cd79af804/download" class="uri">https://www.researchgate.net/publication/230056019_Relationship_between_Chlorophyll-a_Concentration_and_Phytoplankton_Biomass_in_Several_Reservoirs_in_Czechoslovakia/link/5cb56c164585156cd79af804/download</a></p></li>
<li><p><a href="https://archimer.ifremer.fr/doc/2005/publication-1172.pdf" class="uri">https://archimer.ifremer.fr/doc/2005/publication-1172.pdf</a></p></li>
</ul>
<div id="approach" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Approach<a href="data-quality-assessments.html#approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our philosophy here is that we will use chlorophyll <em>a</em> directly as a proxy for
algal biomass to minimize the number of transformations to this data, since we
are primarily interested in how algae alters light attenuation, regardless of
how we estimate algae. However, we still need to calculate non-algal particle
(NAP) mass. For that we will use a range of values of chlorophyll:biomass ratio
and show the impact of picking a single ratio from a set of ranges.</p>
<p><em>Caveats</em></p>
<ul>
<li><p>We don’t have a true NAP to compare how accurate our approach is.</p></li>
<li><p>We do have Inorganic Sediment, but that is not the same thing as non-algal
particles, since it excludes particulate organic carbon. Still, where we
have it, we will examine the relationship between NAP and total inorganic
sediment (TIS)</p></li>
<li><p>Not entirely sure how we propogate this uncertainty downstream? Pick an
average? [[run them all and then get sd/error metrics to describe
uncertainty]]</p></li>
</ul>
<details>
<summary>
Code to apply varying algal biomass ratios.
</summary>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-quality-assessments.html#cb9-1" tabindex="-1"></a>in_vis <span class="ot">&lt;-</span> <span class="fu">read_feather</span>(<span class="fu">file.path</span>(data_out_dir, <span class="st">&#39;simul.feather&#39;</span>))</span>
<span id="cb9-2"><a href="data-quality-assessments.html#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="data-quality-assessments.html#cb9-3" tabindex="-1"></a>no_sech <span class="ot">&lt;-</span> <span class="fu">read_feather</span>(<span class="fu">file.path</span>(data_out_dir, <span class="st">&#39;no_secchi.feather&#39;</span>))</span>
<span id="cb9-4"><a href="data-quality-assessments.html#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="data-quality-assessments.html#cb9-5" tabindex="-1"></a>range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">234</span>)</span>
<span id="cb9-6"><a href="data-quality-assessments.html#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="data-quality-assessments.html#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="data-quality-assessments.html#cb9-8" tabindex="-1"></a><span class="co">#Couldn&#39;t think of a more clever way to multiply</span></span>
<span id="cb9-9"><a href="data-quality-assessments.html#cb9-9" tabindex="-1"></a><span class="co">#chl_a by the range of values, so just made</span></span>
<span id="cb9-10"><a href="data-quality-assessments.html#cb9-10" tabindex="-1"></a><span class="co"># dataframe 4 times bigger with new column called ratio. </span></span>
<span id="cb9-11"><a href="data-quality-assessments.html#cb9-11" tabindex="-1"></a>nap_test <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(no_sech, <span class="at">chl_ratio =</span> range) <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="data-quality-assessments.html#cb9-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">power =</span> <span class="fu">if_else</span>(chl_ratio <span class="sc">==</span> <span class="dv">234</span>, <span class="fl">0.57</span>, <span class="dv">1</span>),</span>
<span id="cb9-13"><a href="data-quality-assessments.html#cb9-13" tabindex="-1"></a>         <span class="at">chl_a_biomass =</span> <span class="fu">exp</span>(<span class="fu">log</span>(chl_ratio<span class="sc">/</span><span class="dv">1000</span>)<span class="sc">+</span><span class="fu">log</span>(chl_a)<span class="sc">*</span>power),</span>
<span id="cb9-14"><a href="data-quality-assessments.html#cb9-14" tabindex="-1"></a>         <span class="at">tss_dead =</span> tss<span class="sc">-</span>chl_a_biomass)</span></code></pre></div>
</details>
</div>
<div id="simple-evaluations-of-conversion" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Simple evaluations of conversion<a href="data-quality-assessments.html#simple-evaluations-of-conversion" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="negative-tss_dead" class="section level4 hasAnchor" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> Negative tss_dead<a href="data-quality-assessments.html#negative-tss_dead" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Probably the simplest way to see which ratios are more appropriate is to look at
how that impacts how many tss_dead observations are negative, which is
impossible.</p>
<details>
<summary>
Code for table.
</summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-quality-assessments.html#cb10-1" tabindex="-1"></a>neg_tss_dead <span class="ot">&lt;-</span> nap_test <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="data-quality-assessments.html#cb10-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">negative =</span> <span class="fu">ifelse</span>(tss_dead <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">&#39;negative&#39;</span>, <span class="st">&#39;positive&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="data-quality-assessments.html#cb10-3" tabindex="-1"></a>  <span class="fu">group_by</span>(negative,chl_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="data-quality-assessments.html#cb10-4" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="data-quality-assessments.html#cb10-5" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&#39;negative&#39;</span>,<span class="at">values_from =</span> <span class="st">&#39;n&#39;</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="data-quality-assessments.html#cb10-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent_neg =</span> negative<span class="sc">/</span>(positive<span class="sc">+</span>negative)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="data-quality-assessments.html#cb10-7" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;Varying chlorohpyll ratios and summary of negative tss_dead results.&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
<span id="tab:neg-tss-dead">Table 3.1: </span>Varying chlorohpyll ratios and summary of negative tss_dead results.
</caption>
<thead>
<tr>
<th style="text-align:right;">
chl_ratio
</th>
<th style="text-align:right;">
negative
</th>
<th style="text-align:right;">
positive
</th>
<th style="text-align:right;">
percent_neg
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
341
</td>
<td style="text-align:right;">
163822
</td>
<td style="text-align:right;">
0.2077204
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
1324
</td>
<td style="text-align:right;">
162839
</td>
<td style="text-align:right;">
0.8065155
</td>
</tr>
<tr>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
6912
</td>
<td style="text-align:right;">
157251
</td>
<td style="text-align:right;">
4.2104494
</td>
</tr>
<tr>
<td style="text-align:right;">
234
</td>
<td style="text-align:right;">
567
</td>
<td style="text-align:right;">
163596
</td>
<td style="text-align:right;">
0.3453884
</td>
</tr>
</tbody>
</table>
<p>Well, that sort of produces obvious results. Smaller ratios mean, less negative
NAP estimates, but there is a big increase between 100-200, making me think the
“correct” ratio may be in there somewhere.</p>
</div>
<div id="relationship-between-chlorophyll-a-and-tss_dead" class="section level4 hasAnchor" number="3.1.2.2">
<h4><span class="header-section-number">3.1.2.2</span> Relationship between chlorophyll-a and tss_dead<a href="data-quality-assessments.html#relationship-between-chlorophyll-a-and-tss_dead" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If you recall from the previous section, there was a linear relationship between
chlorophyll <em>a</em> and TSS across all sites and water types (r<sup>2</sup> &gt; 0.35). One
effect we’d expect to see with the tss_dead estimate is that this relationship
should decay. While there are reasons for chlorophyll <em>a</em> to be correlated with
TSS (sediment brings nutrients for example), chlorophyll <em>a</em> also includes algal
cells which are suspended particles themselves. If this approach worked well, we
should see weaker relationships between tss_dead and chlorophyll <em>a</em>.</p>
<details>
<summary>
Code for figure.
</summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-quality-assessments.html#cb11-1" tabindex="-1"></a><span class="co">#Subset for plotting purposes</span></span>
<span id="cb11-2"><a href="data-quality-assessments.html#cb11-2" tabindex="-1"></a>tss_dead_chla <span class="ot">&lt;-</span> nap_test <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="data-quality-assessments.html#cb11-3" tabindex="-1"></a>  <span class="co">#Remove negatives and very small numbers (ug/L of sediment is basically zero)</span></span>
<span id="cb11-4"><a href="data-quality-assessments.html#cb11-4" tabindex="-1"></a>  <span class="fu">filter</span>(tss_dead <span class="sc">&gt;</span> <span class="fl">0.001</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="data-quality-assessments.html#cb11-5" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="fl">0.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="data-quality-assessments.html#cb11-6" tabindex="-1"></a><span class="fu">ggplot</span>(., <span class="fu">aes</span>(chl_a,tss_dead,<span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb11-7"><a href="data-quality-assessments.html#cb11-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>chl_ratio) <span class="sc">+</span> </span>
<span id="cb11-8"><a href="data-quality-assessments.html#cb11-8" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb11-9"><a href="data-quality-assessments.html#cb11-9" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span> </span>
<span id="cb11-10"><a href="data-quality-assessments.html#cb11-10" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb11-11"><a href="data-quality-assessments.html#cb11-11" tabindex="-1"></a>  <span class="fu">stat_poly_eq</span>(<span class="at">small.r =</span> T) <span class="sc">+</span> </span>
<span id="cb11-12"><a href="data-quality-assessments.html#cb11-12" tabindex="-1"></a>  <span class="fu">theme_few</span>() <span class="sc">+</span> </span>
<span id="cb11-13"><a href="data-quality-assessments.html#cb11-13" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;seagreen3&#39;</span>,<span class="st">&#39;skyblue3&#39;</span>,<span class="st">&#39;saddlebrown&#39;</span>)) </span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-1"></span>
<img src="Ternary-Light-Partitioning_files/figure-html/unnamed-chunk-1-1.png" alt="At low chl_ratios (10/20), there is really no change to the correlation between tss and chl_a, but at higher ratios (100/200), the relationship does breakdown some, though not completely" width="672" />
<p class="caption">
Figure 3.1: At low chl_ratios (10/20), there is really no change to the correlation between tss and chl_a, but at higher ratios (100/200), the relationship does breakdown some, though not completely
</p>
</div>
<ul>
<li>What to do with this?</li>
<li>234*chl<sup>0.57</sup> seems logical but still high correlation in lakes between
tss/chl_a, but that may be a real thing for lakes? (corr is actually higher
with this approach)</li>
</ul>
</div>
</div>
<div id="light-attenuation-model-exploration" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Light attenuation model exploration<a href="data-quality-assessments.html#light-attenuation-model-exploration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Model assumptions</p>
<ul>
<li><p>Not searching for intercept assuming observed 0.15 coefficient for intercept
(pure water attenuation)</p></li>
<li><p>For now, not doing the middle 2.5-97.5% of data, can add back in.</p></li>
<li><p>Normality assumptions aren’t fully met</p></li>
</ul>
<details>
<summary>
Code for this section.
</summary>
<p>[[noting that kd here is 1/secchi, which is yet a different constant for
calculating kd, also for the derp in the class (me) please give insight on the
1/1.5/max secchi as kw.]]</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-quality-assessments.html#cb12-1" tabindex="-1"></a>nap_est_no_secchi <span class="ot">&lt;-</span> nap_test <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="data-quality-assessments.html#cb12-2" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="data-quality-assessments.html#cb12-3" tabindex="-1"></a>  <span class="fu">filter</span>(tss_dead <span class="sc">&gt;</span> <span class="fl">0.01</span>,</span>
<span id="cb12-4"><a href="data-quality-assessments.html#cb12-4" tabindex="-1"></a>         secchi <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">|</span> <span class="fu">is.na</span>(secchi)) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="data-quality-assessments.html#cb12-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">secchi =</span> <span class="fu">ifelse</span>(secchi <span class="sc">&lt;</span> <span class="fl">0.1</span>,<span class="fl">0.1</span>,secchi),</span>
<span id="cb12-6"><a href="data-quality-assessments.html#cb12-6" tabindex="-1"></a>        <span class="at">kd =</span> (<span class="dv">1</span><span class="sc">/</span>(secchi)))</span>
<span id="cb12-7"><a href="data-quality-assessments.html#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="data-quality-assessments.html#cb12-8" tabindex="-1"></a><span class="fu">write_feather</span>(nap_est_no_secchi <span class="sc">%&gt;%</span></span>
<span id="cb12-9"><a href="data-quality-assessments.html#cb12-9" tabindex="-1"></a>                <span class="fu">filter</span>(chl_ratio <span class="sc">==</span> <span class="dv">234</span>),</span>
<span id="cb12-10"><a href="data-quality-assessments.html#cb12-10" tabindex="-1"></a>              <span class="fu">file.path</span>(data_out_dir, <span class="st">&#39;no_secchi_clean.feather&#39;</span>))</span>
<span id="cb12-11"><a href="data-quality-assessments.html#cb12-11" tabindex="-1"></a></span>
<span id="cb12-12"><a href="data-quality-assessments.html#cb12-12" tabindex="-1"></a>nap_est <span class="ot">&lt;-</span> nap_est_no_secchi <span class="sc">%&gt;%</span></span>
<span id="cb12-13"><a href="data-quality-assessments.html#cb12-13" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(secchi))</span>
<span id="cb12-14"><a href="data-quality-assessments.html#cb12-14" tabindex="-1"></a></span>
<span id="cb12-15"><a href="data-quality-assessments.html#cb12-15" tabindex="-1"></a></span>
<span id="cb12-16"><a href="data-quality-assessments.html#cb12-16" tabindex="-1"></a>k_w <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fl">1.5</span><span class="sc">/</span><span class="fu">max</span>(nap_est<span class="sc">$</span>secchi)</span>
<span id="cb12-17"><a href="data-quality-assessments.html#cb12-17" tabindex="-1"></a></span>
<span id="cb12-18"><a href="data-quality-assessments.html#cb12-18" tabindex="-1"></a>kd_mod <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb12-19"><a href="data-quality-assessments.html#cb12-19" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">lm</span>((kd<span class="sc">-</span>k_w)  <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> tss_dead <span class="sc">+</span> doc <span class="sc">+</span> chl_a, <span class="at">data =</span> df)</span>
<span id="cb12-20"><a href="data-quality-assessments.html#cb12-20" tabindex="-1"></a>}</span>
<span id="cb12-21"><a href="data-quality-assessments.html#cb12-21" tabindex="-1"></a></span>
<span id="cb12-22"><a href="data-quality-assessments.html#cb12-22" tabindex="-1"></a>kd_resid_extract <span class="ot">&lt;-</span> <span class="cf">function</span>(df,mod){</span>
<span id="cb12-23"><a href="data-quality-assessments.html#cb12-23" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb12-24"><a href="data-quality-assessments.html#cb12-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">residuals =</span> mod<span class="sc">$</span>residuals,</span>
<span id="cb12-25"><a href="data-quality-assessments.html#cb12-25" tabindex="-1"></a>           <span class="at">pred =</span> mod<span class="sc">$</span>fitted.values <span class="sc">+</span> k_w)</span>
<span id="cb12-26"><a href="data-quality-assessments.html#cb12-26" tabindex="-1"></a>}</span>
<span id="cb12-27"><a href="data-quality-assessments.html#cb12-27" tabindex="-1"></a></span>
<span id="cb12-28"><a href="data-quality-assessments.html#cb12-28" tabindex="-1"></a><span class="co"># nap_est &lt;- nap_est %&gt;%</span></span>
<span id="cb12-29"><a href="data-quality-assessments.html#cb12-29" tabindex="-1"></a><span class="co">#   filter(SiteID %in% fine_sites$SiteID) </span></span>
<span id="cb12-30"><a href="data-quality-assessments.html#cb12-30" tabindex="-1"></a></span>
<span id="cb12-31"><a href="data-quality-assessments.html#cb12-31" tabindex="-1"></a>nap_mods <span class="ot">&lt;-</span> <span class="fu">group_by</span>(nap_est,chl_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb12-32"><a href="data-quality-assessments.html#cb12-32" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-33"><a href="data-quality-assessments.html#cb12-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mods =</span> <span class="fu">map</span>(data, kd_mod),</span>
<span id="cb12-34"><a href="data-quality-assessments.html#cb12-34" tabindex="-1"></a>         <span class="at">data =</span> <span class="fu">map2</span>(data, mods, kd_resid_extract))</span>
<span id="cb12-35"><a href="data-quality-assessments.html#cb12-35" tabindex="-1"></a></span>
<span id="cb12-36"><a href="data-quality-assessments.html#cb12-36" tabindex="-1"></a>mod234 <span class="ot">&lt;-</span> nap_mods <span class="sc">%&gt;%</span></span>
<span id="cb12-37"><a href="data-quality-assessments.html#cb12-37" tabindex="-1"></a>  <span class="fu">filter</span>(chl_ratio <span class="sc">==</span> <span class="dv">234</span>)</span>
<span id="cb12-38"><a href="data-quality-assessments.html#cb12-38" tabindex="-1"></a></span>
<span id="cb12-39"><a href="data-quality-assessments.html#cb12-39" tabindex="-1"></a>nap_resid <span class="ot">&lt;-</span> nap_mods <span class="sc">%&gt;%</span></span>
<span id="cb12-40"><a href="data-quality-assessments.html#cb12-40" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>mods) <span class="sc">%&gt;%</span></span>
<span id="cb12-41"><a href="data-quality-assessments.html#cb12-41" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb12-42"><a href="data-quality-assessments.html#cb12-42" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ratio_rmse =</span> <span class="fu">paste</span>(<span class="st">&#39;ratio =&#39;</span>,chl_ratio,<span class="st">&#39;, r^2 =&#39;</span>, <span class="fu">round</span>(<span class="fu">cor</span>(pred,kd)<span class="sc">^</span><span class="dv">2</span>,<span class="dv">2</span>)),</span>
<span id="cb12-43"><a href="data-quality-assessments.html#cb12-43" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(date_unity))</span>
<span id="cb12-44"><a href="data-quality-assessments.html#cb12-44" tabindex="-1"></a></span>
<span id="cb12-45"><a href="data-quality-assessments.html#cb12-45" tabindex="-1"></a>kd_obs_pred <span class="ot">&lt;-</span> nap_resid <span class="sc">%&gt;%</span></span>
<span id="cb12-46"><a href="data-quality-assessments.html#cb12-46" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="fl">0.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-47"><a href="data-quality-assessments.html#cb12-47" tabindex="-1"></a>  <span class="fu">ggplot</span>(., <span class="fu">aes</span>(kd,pred, <span class="at">color =</span> <span class="fu">year</span>(date_unity))) <span class="sc">+</span> </span>
<span id="cb12-48"><a href="data-quality-assessments.html#cb12-48" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb12-49"><a href="data-quality-assessments.html#cb12-49" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ratio_rmse) <span class="sc">+</span> </span>
<span id="cb12-50"><a href="data-quality-assessments.html#cb12-50" tabindex="-1"></a>  <span class="fu">theme_few</span>() <span class="sc">+</span> </span>
<span id="cb12-51"><a href="data-quality-assessments.html#cb12-51" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;kd (1/secchi)&#39;</span>) <span class="sc">+</span> <span class="co">#tagging this too, as the constant of 1.</span></span>
<span id="cb12-52"><a href="data-quality-assessments.html#cb12-52" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;predicted kd&#39;</span>) <span class="sc">+</span></span>
<span id="cb12-53"><a href="data-quality-assessments.html#cb12-53" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span> </span>
<span id="cb12-54"><a href="data-quality-assessments.html#cb12-54" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb12-55"><a href="data-quality-assessments.html#cb12-55" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb12-56"><a href="data-quality-assessments.html#cb12-56" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>,<span class="at">se =</span> F, <span class="at">color =</span> <span class="st">&#39;black&#39;</span>) <span class="sc">+</span></span>
<span id="cb12-57"><a href="data-quality-assessments.html#cb12-57" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>) </span></code></pre></div>
</details>
<div class="figure">
<img src="Ternary-Light-Partitioning_files/figure-html/fig%20kd-pred-obs-1.png" alt="Modelled light extinction coefficient (Kd) versus observed, red line is 1:1 line and blue is line of best fit, r^2 hardly varies between chlorophyll a conversion approaches." width="672" />
<p class="caption">
(#fig:fig kd-pred-obs)Modelled light extinction coefficient (Kd) versus observed, red line is 1:1 line and blue is line of best fit, r^2 hardly varies between chlorophyll a conversion approaches.
</p>
</div>
</div>
<div id="variation-in-slopes-w-different-chl-biomass-ratios" class="section level3 hasAnchor" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Variation in slopes w/ different chl biomass ratios<a href="data-quality-assessments.html#variation-in-slopes-w-different-chl-biomass-ratios" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Do all our painstaking decisions make a difference for model slopes?</p></li>
<li><p>(They didn’t impact model RMSE very much)</p></li>
<li><p>No, they don’t change slopes all that much either.</p></li>
</ul>
<details>
<summary>
Code for table.
</summary>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-quality-assessments.html#cb13-1" tabindex="-1"></a>nap_slopes <span class="ot">&lt;-</span> nap_mods <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="data-quality-assessments.html#cb13-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="data-quality-assessments.html#cb13-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">glance =</span> <span class="fu">map</span>(mods, tidy)) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="data-quality-assessments.html#cb13-4" tabindex="-1"></a>  <span class="fu">unnest</span>(glance) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="data-quality-assessments.html#cb13-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>mods,<span class="sc">-</span>std.error,<span class="sc">-</span>statistic) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="data-quality-assessments.html#cb13-6" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&#39;term&#39;</span>, <span class="at">values_from =</span> <span class="st">&#39;estimate&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-7"><a href="data-quality-assessments.html#cb13-7" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;Varying chlorophyll ratios and summary of slopes across parameters.&quot;</span>)</span>
<span id="cb13-8"><a href="data-quality-assessments.html#cb13-8" tabindex="-1"></a></span>
<span id="cb13-9"><a href="data-quality-assessments.html#cb13-9" tabindex="-1"></a><span class="co"># kable(nap_slopes) %&gt;%</span></span>
<span id="cb13-10"><a href="data-quality-assessments.html#cb13-10" tabindex="-1"></a><span class="co">#   kable_paper() %&gt;%</span></span>
<span id="cb13-11"><a href="data-quality-assessments.html#cb13-11" tabindex="-1"></a><span class="co">#   scroll_box(width = &#39;100%&#39;, height = &#39;600px&#39;) %&gt;%</span></span>
<span id="cb13-12"><a href="data-quality-assessments.html#cb13-12" tabindex="-1"></a><span class="co">#   kable_styling(bootstrap_options = &#39;striped&#39;, full_width = T)</span></span></code></pre></div>
</details>
<table>
<caption>
<span id="tab:pre-tab-nap-slope">Table 3.2: </span>Varying chlorophyll ratios and summary of slopes across parameters.
</caption>
<thead>
<tr>
<th style="text-align:right;">
chl_ratio
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
tss_dead
</th>
<th style="text-align:right;">
doc
</th>
<th style="text-align:right;">
chl_a
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0305438
</td>
<td style="text-align:right;">
0.0739141
</td>
<td style="text-align:right;">
0.0107571
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0303281
</td>
<td style="text-align:right;">
0.0734118
</td>
<td style="text-align:right;">
0.0129565
</td>
</tr>
<tr>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0294995
</td>
<td style="text-align:right;">
0.0731412
</td>
<td style="text-align:right;">
0.0184780
</td>
</tr>
<tr>
<td style="text-align:right;">
234
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0305790
</td>
<td style="text-align:right;">
0.0752755
</td>
<td style="text-align:right;">
0.0098798
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="final-decision" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Final Decision<a href="data-quality-assessments.html#final-decision" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Based on the above approaches and logic, the chl-a to biomass multiplier
does not impact model performance very much. As such, we are going to use
the 234 log ratio going forward.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="download-and-merge-aquasat-data.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
